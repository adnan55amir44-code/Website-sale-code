<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #6C63FF;
            --secondary: #3F3D56;
            --bg: #F9F9F9;
            --card: #FFFFFF;
            --text: #2F2E41;
            --green: #00b894;
            --red: #ff7675;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: var(--text); padding-bottom: 80px; }

        /* HEADER */
        header {
            background: var(--card); padding: 15px 20px; position: sticky; top: 0; z-index: 100;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05); border-radius: 0 0 20px 20px;
        }
        .top-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .brand { font-size: 1.4rem; font-weight: 700; color: var(--primary); }
        .search-box { position: relative; }
        .search-box input {
            width: 100%; background: #F0F0F0; border: none; padding: 12px 15px 12px 40px;
            border-radius: 12px; font-size: 0.95rem; outline: none;
        }
        .search-box i { position: absolute; left: 15px; top: 12px; color: #aaa; }

        /* NOTICE */
        #notice-area {
            background: linear-gradient(45deg, #ff9f43, #ff6b6b); color: white;
            text-align: center; padding: 10px; font-size: 0.85rem; font-weight: 600;
            display: none; animation: slideDown 0.5s;
        }

        /* PRODUCT GRID */
        .container { padding: 20px; }
        .grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        
        .product-card {
            background: var(--card); border-radius: 15px; overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); transition: 0.3s;
            display: flex; flex-direction: column;
        }
        .product-card:active { transform: scale(0.97); }
        .p-img {
            height: 140px; background: #eee; background-size: cover; background-position: center;
        }
        .p-details { padding: 12px; flex: 1; display: flex; flex-direction: column; }
        .p-title { font-size: 0.9rem; font-weight: 600; margin-bottom: 5px; line-height: 1.3; color: var(--secondary); }
        .p-footer { margin-top: auto; display: flex; justify-content: space-between; align-items: center; }
        .p-price { font-weight: 700; color: var(--primary); font-size: 1rem; }
        .btn-buy-mini {
            background: var(--primary); color: white; width: 30px; height: 30px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; box-shadow: 0 4px 10px rgba(108, 99, 255, 0.3);
        }

        /* BOTTOM NAV */
        .bottom-nav {
            position: fixed; bottom: 0; left: 0; width: 100%; background: var(--card);
            padding: 12px 0; display: flex; justify-content: space-around;
            box-shadow: 0 -5px 20px rgba(0,0,0,0.05); z-index: 90; border-radius: 20px 20px 0 0;
        }
        .nav-item { text-align: center; color: #b2bec3; font-size: 0.75rem; transition: 0.3s; }
        .nav-item i { font-size: 1.3rem; margin-bottom: 4px; display: block; }
        .nav-item.active { color: var(--primary); transform: translateY(-3px); }

        /* MODALS (Bottom Sheet Style) */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); backdrop-filter: blur(5px);
            z-index: 200; visibility: hidden; opacity: 0; transition: 0.3s;
            display: flex; align-items: flex-end; justify-content: center;
        }
        .modal-overlay.active { visibility: visible; opacity: 1; }
        
        .modal-sheet {
            background: var(--card); width: 100%; max-width: 500px;
            border-radius: 25px 25px 0 0; padding: 25px;
            transform: translateY(100%); transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 90vh; overflow-y: auto;
        }
        .modal-overlay.active .modal-sheet { transform: translateY(0); }

        .sheet-header { display: flex; justify-content: space-between; margin-bottom: 20px; }
        .sheet-title { font-size: 1.2rem; font-weight: 700; }
        .close-btn { background: #f1f2f6; border: none; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; }

        .btn-main {
            width: 100%; padding: 15px; border: none; border-radius: 12px;
            background: var(--primary); color: white; font-weight: 600; font-size: 1rem;
            margin-top: 15px; box-shadow: 0 5px 15px rgba(108, 99, 255, 0.3);
        }
        .btn-outline {
            width: 100%; padding: 12px; border: 2px solid #eee; background: transparent;
            border-radius: 12px; font-weight: 600; color: #777; margin-top: 10px;
        }

        /* Payment Specifics */
        .bank-card {
            background: #f8f9fa; border: 1px dashed #ced6e0; padding: 15px;
            border-radius: 10px; margin: 15px 0; font-size: 0.9rem;
        }
        .qr-area { text-align: center; margin: 15px 0; }
        .qr-img { max-width: 200px; border-radius: 10px; display: none; }
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; font-size: 0.8rem; color: #888; margin-bottom: 5px; }
        .input-group input { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 10px; outline: none; }

        .status-card {
            background: #f8f9fa; padding: 15px; border-radius: 12px; margin-bottom: 10px;
            border-left: 5px solid #ccc; display: flex; justify-content: space-between; align-items: center;
        }
        @keyframes slideDown { from{transform:translateY(-100%)} to{transform:translateY(0)} }
    </style>
</head>
<body>

    <!-- Notice -->
    <div id="notice-area"></div>

    <!-- Header -->
    <header>
        <div class="top-bar">
            <div class="brand"><i class="fas fa-shapes"></i> CodeStore</div>
            <div onclick="openProfile()"><i class="fas fa-user-circle" style="font-size: 1.8rem; color: var(--secondary);"></i></div>
        </div>
        <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="search" placeholder="Search products..." onkeyup="filterProds()">
        </div>
    </header>

    <!-- Content -->
    <div class="container">
        <div id="grid" class="grid">
            <!-- Products Loaded Here -->
            <div style="grid-column:span 2; text-align:center; margin-top:50px; color:#aaa;">
                <i class="fas fa-circle-notch fa-spin"></i> Loading products...
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="modal-prod" class="modal-overlay">
        <div class="modal-sheet">
            <div class="sheet-header">
                <div class="sheet-title">Details</div>
                <button class="close-btn" onclick="closeModal('modal-prod')">&times;</button>
            </div>
            <div id="d-img" style="width:100%; height:200px; background:#eee; border-radius:15px; background-size:cover; margin-bottom:15px;"></div>
            <h2 id="d-name">Product Name</h2>
            <h3 id="d-price" style="color:var(--primary); margin:5px 0;">$0.00</h3>
            <p id="d-desc" style="color:#777; font-size:0.9rem; line-height:1.6; margin: 15px 0;">Description...</p>
            <button class="btn-main" onclick="goToPay()">Buy Now</button>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="modal-pay" class="modal-overlay">
        <div class="modal-sheet">
            <div class="sheet-header">
                <div class="sheet-title">Checkout</div>
                <button class="close-btn" onclick="closeModal('modal-pay')">&times;</button>
            </div>
            
            <div class="bank-card">
                <div id="bank-det">Loading Bank Details...</div>
                <div id="pay-inst" style="margin-top:10px; color:#e17055; font-size:0.8rem;"></div>
            </div>

            <button class="btn-outline" onclick="loadQR()" style="border-color:var(--primary); color:var(--primary);">
                <i class="fas fa-qrcode"></i> Show Payment QR
            </button>
            <div class="qr-area">
                <div id="qr-loader" style="display:none;"><i class="fas fa-spinner fa-spin"></i></div>
                <img id="qr-img" class="qr-img" alt="Payment QR">
            </div>

            <div class="input-group">
                <label>Your Name</label>
                <input type="text" id="ord-name" placeholder="Full Name">
            </div>
            <div class="input-group">
                <label>Email (for delivery)</label>
                <input type="email" id="ord-email" placeholder="example@gmail.com">
            </div>
            <div class="input-group">
                <label>Transaction ID / Ref No.</label>
                <input type="text" id="ord-ref" placeholder="Paste ID here">
            </div>

            <button class="btn-main" onclick="submitOrder()">Confirm Payment</button>
        </div>
    </div>

    <!-- Profile Modal -->
    <div id="modal-prof" class="modal-overlay">
        <div class="modal-sheet">
            <div class="sheet-header">
                <div class="sheet-title">My Orders</div>
                <button class="close-btn" onclick="closeModal('modal-prof')">&times;</button>
            </div>
            <div class="input-group" style="display:flex; gap:10px;">
                <input type="email" id="track-email" placeholder="Enter Email to Track">
                <button onclick="track()" style="padding:0 15px; border:none; background:var(--secondary); color:white; border-radius:10px;"><i class="fas fa-search"></i></button>
            </div>
            <div id="history" style="margin-top:20px; max-height:300px; overflow-y:auto;"></div>
        </div>
    </div>

    <!-- Bottom Nav -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="window.scrollTo(0,0)"><i class="fas fa-home"></i>Home</div>
        <div class="nav-item" onclick="openProfile()"><i class="fas fa-box-open"></i>Orders</div>
        <div class="nav-item" onclick="window.open('mailto:support@email.com')"><i class="fas fa-headset"></i>Help</div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // CONFIG
        const firebaseConfig = {
  apiKey: "AIzaSyAGUjJ47wOlND5-6Au97AOdb5ALzwUbx_Q",
  authDomain: "mobile-repairing-1c087.firebaseapp.com",
  databaseURL: "https://mobile-repairing-1c087-default-rtdb.firebaseio.com",
  projectId: "mobile-repairing-1c087",
  storageBucket: "mobile-repairing-1c087.firebasestorage.app",
  messagingSenderId: "313283568116",
  appId: "1:313283568116:web:a5e15db94303dbf9ee59a1"
};
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let products = [];
        let curProd = null;
        let settings = {};

        window.onload = () => {
            db.ref('analytics/visits').transaction(v => (v||0)+1);
            loadData();
            const lastEmail = localStorage.getItem('userEmail');
            if(lastEmail) document.getElementById('track-email').value = lastEmail;
        };

        function loadData() {
            // Products
            db.ref('products').on('value', s => {
                products = [];
                const g = document.getElementById('grid'); g.innerHTML = '';
                s.forEach(c => {
                    const p = c.val(); p.id = c.key; products.push(p);
                    g.innerHTML += `
                    <div class="product-card" onclick="openProd('${p.id}')">
                        <div class="p-img" style="background-image:url('${p.image}')"></div>
                        <div class="p-details">
                            <div class="p-title">${p.name}</div>
                            <div class="p-footer">
                                <div class="p-price">$${p.price}</div>
                                <div class="btn-buy-mini"><i class="fas fa-shopping-cart"></i></div>
                            </div>
                        </div>
                    </div>`;
                });
            });

            // Settings
            db.ref('settings').on('value', s => {
                settings = s.val() || {};
                // Notice
                const n = document.getElementById('notice-area');
                if(settings.noticeOn && settings.notice) {
                    n.innerText = settings.notice; n.style.display='block';
                } else n.style.display='none';
                
                // Bank
                document.getElementById('bank-det').innerHTML = `
                    <b>Bank:</b> ${settings.bank||'N/A'}<br>
                    <b>Title:</b> ${settings.title||'N/A'}<br>
                    <b>Account:</b> ${settings.num||'N/A'}
                `;
                document.getElementById('pay-inst').innerText = settings.inst || '';
            });
        }

        // Logic
        function filterProds() {
            const q = document.getElementById('search').value.toLowerCase();
            const g = document.getElementById('grid'); g.innerHTML = '';
            products.filter(p=>p.name.toLowerCase().includes(q)).forEach(p => {
                g.innerHTML += `
                <div class="product-card" onclick="openProd('${p.id}')">
                    <div class="p-img" style="background-image:url('${p.image}')"></div>
                    <div class="p-details">
                        <div class="p-title">${p.name}</div>
                        <div class="p-footer">
                            <div class="p-price">$${p.price}</div>
                            <div class="btn-buy-mini"><i class="fas fa-shopping-cart"></i></div>
                        </div>
                    </div>
                </div>`;
            });
        }

        function openProd(id) {
            curProd = products.find(p=>p.id===id);
            document.getElementById('d-img').style.backgroundImage = `url('${curProd.image}')`;
            document.getElementById('d-name').innerText = curProd.name;
            document.getElementById('d-price').innerText = '$'+curProd.price;
            document.getElementById('d-desc').innerText = curProd.desc;
            openModal('modal-prod');
        }

        function goToPay() {
            closeModal('modal-prod');
            setTimeout(() => openModal('modal-pay'), 300);
            document.getElementById('qr-img').style.display = 'none';
        }

        function loadQR() {
            if(!settings.img) return alert('No QR Code available');
            const img = document.getElementById('qr-img');
            const l = document.getElementById('qr-loader');
            l.style.display = 'block'; img.style.display = 'none';
            img.src = settings.img;
            img.onload = () => { l.style.display='none'; img.style.display='block'; }
        }

        function submitOrder() {
            const n = document.getElementById('ord-name').value;
            const e = document.getElementById('ord-email').value;
            const r = document.getElementById('ord-ref').value;
            
            if(!n || !e || !r) return alert('Fill all fields');
            
            db.ref('orders').push({
                userName: n, userEmail: e, ref: r,
                productName: curProd.name, price: curProd.price,
                productId: curProd.id, status: 'Pending', ts: Date.now()
            });
            
            localStorage.setItem('userEmail', e);
            alert('Order Submitted!');
            closeModal('modal-pay');
        }

        function track() {
            const e = document.getElementById('track-email').value;
            if(!e) return;
            localStorage.setItem('userEmail', e);
            db.ref('orders').orderByChild('userEmail').equalTo(e).once('value', s => {
                const h = document.getElementById('history'); h.innerHTML = '';
                if(!s.exists()) h.innerHTML = '<p style="text-align:center">No orders found.</p>';
                s.forEach(c => {
                    const o = c.val();
                    let col = 'orange'; let msg = 'Processing';
                    let btn = '';
                    
                    if(o.status==='Approved') {
                        col = '#00b894'; msg = 'Approved';
                        btn = `<button style="background:var(--primary); color:white; border:none; padding:5px 10px; border-radius:5px; margin-top:5px; width:100%;" onclick="dl('${o.productId}')">Download File</button>`;
                    } else if(o.status==='Rejected') { col = '#ff7675'; msg = 'Rejected'; }

                    h.innerHTML += `
                    <div class="status-card" style="border-left-color:${col}; display:block;">
                        <div style="display:flex; justify-content:space-between;">
                            <b>${o.productName}</b>
                            <span style="color:${col}; font-weight:bold;">${msg}</span>
                        </div>
                        <div style="font-size:0.8rem; color:#888;">Ref: ${o.ref}</div>
                        ${btn}
                    </div>`;
                });
            });
        }

        function dl(pid) {
            db.ref('products/'+pid+'/link').once('value', s => window.open(s.val()));
        }

        function openModal(id) { document.getElementById(id).classList.add('active'); }
        function closeModal(id) { document.getElementById(id).classList.remove('active'); }
        function openProfile() { openModal('modal-prof'); track(); }
    </script>
    <script src="https://pl28658039.effectivegatecpm.com/99/8a/37/998a37a5fed98d666ef2fce2feda8456.js"></script>
</body>
</html>