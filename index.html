<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Pro Like - Digital Store</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            /* Light Mode Colors */
            --primary: #6C63FF;
            --primary-light: #8B85FF;
            --primary-dark: #5651CC;
            --secondary: #3F3D56;
            --secondary-light: #5A5873;
            --bg: #F9F9F9;
            --card: #FFFFFF;
            --text: #2F2E41;
            --text-light: #6C6B7E;
            --border: #EAEAF2;
            --green: #00b894;
            --red: #ff7675;
            --orange: #ff9f43;
            --shadow: rgba(0, 0, 0, 0.08);
            --gradient: linear-gradient(135deg, #6C63FF 0%, #8B85FF 100%);
            --radius: 16px;
            --radius-sm: 10px;
            --transition: all 0.3s ease;
        }

        /* Dark Mode Colors */
        .dark-mode {
            --primary: #8B85FF;
            --primary-light: #A6A2FF;
            --primary-dark: #6C63FF;
            --secondary: #C6C5D3;
            --secondary-light: #E2E1EA;
            --bg: #121212;
            --card: #1E1E1E;
            --text: #F0F0F0;
            --text-light: #A0A0A0;
            --border: #2D2D2D;
            --shadow: rgba(0, 0, 0, 0.25);
            --gradient: linear-gradient(135deg, #8B85FF 0%, #A6A2FF 100%);
        }

        /* Reset & Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            transition: var(--transition);
            line-height: 1.6;
            overflow-x: hidden;
            padding-bottom: 90px;
        }

        /* Header */
        header {
            background-color: var(--card);
            padding: 18px 20px;
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 20px var(--shadow);
            border-radius: 0 0 var(--radius) var(--radius);
            transition: var(--transition);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .brand {
            font-size: 1.6rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Logo Placeholder - आप इसे logo.png से replace कर सकते हैं */
        #logo-placeholder {
            width: 36px;
            height: 36px;
            background: var(--gradient);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 800;
            font-size: 0.9rem;
        }

        /* अगर आप logo.png use करना चाहते हैं, तो इसे uncomment करें */
        /*
        .site-logo {
            height: 36px;
            width: auto;
            border-radius: 8px;
        }
        */

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        /* Theme Toggle */
        .theme-toggle {
            display: flex;
            align-items: center;
            gap: 8px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 30px;
            padding: 6px;
            cursor: pointer;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px var(--shadow);
        }

        .theme-toggle i {
            font-size: 1.1rem;
            padding: 8px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .theme-toggle .sun {
            color: #FFD700;
            background-color: rgba(255, 215, 0, 0.1);
        }

        .theme-toggle .moon {
            color: #8B85FF;
            background-color: rgba(139, 133, 255, 0.1);
        }

        /* Search Box */
        .search-box {
            position: relative;
            flex-grow: 1;
            max-width: 500px;
            margin: 0 20px;
        }

        .search-box input {
            width: 100%;
            background-color: var(--card);
            border: 1px solid var(--border);
            padding: 14px 20px 14px 48px;
            border-radius: var(--radius-sm);
            font-size: 0.95rem;
            outline: none;
            color: var(--text);
            transition: var(--transition);
        }

        .search-box input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
        }

        .search-box i {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-light);
            font-size: 1rem;
        }

        /* User Profile */
        .user-profile {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 42px;
            height: 42px;
            background: var(--gradient);
            border-radius: 50%;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 12px rgba(108, 99, 255, 0.3);
        }

        .user-profile:hover {
            transform: scale(1.05);
        }

        /* Notice Banner */
        #notice-area {
            background: var(--gradient);
            color: white;
            text-align: center;
            padding: 12px;
            font-size: 0.85rem;
            font-weight: 600;
            display: none;
            animation: slideDown 0.5s;
            position: relative;
            overflow: hidden;
        }

        #notice-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 3s infinite;
        }

        /* Product Grid */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 25px 20px;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--text);
            position: relative;
            display: inline-block;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -8px;
            left: 0;
            width: 60px;
            height: 4px;
            background: var(--gradient);
            border-radius: 2px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
        }

        /* Product Card */
        .product-card {
            background: var(--card);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: 0 8px 25px var(--shadow);
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px var(--shadow);
        }

        .product-card:active {
            transform: translateY(-5px);
        }

        .p-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--gradient);
            color: white;
            padding: 5px 12px;
            border-radius: 30px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 2;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .p-img {
            height: 180px;
            background-color: #f0f0f0;
            background-size: cover;
            background-position: center;
            transition: var(--transition);
        }

        .product-card:hover .p-img {
            transform: scale(1.05);
        }

        .p-details {
            padding: 20px;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .p-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--text);
            line-height: 1.4;
        }

        .p-desc {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 15px;
            flex-grow: 1;
        }

        .p-footer {
            margin-top: auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .p-price {
            font-weight: 800;
            color: var(--primary);
            font-size: 1.3rem;
        }

        .btn-buy-mini {
            background: var(--gradient);
            color: white;
            width: 42px;
            height: 42px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            box-shadow: 0 6px 15px rgba(108, 99, 255, 0.3);
            transition: var(--transition);
            cursor: pointer;
        }

        .btn-buy-mini:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 20px rgba(108, 99, 255, 0.4);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: var(--card);
            padding: 15px 0;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -5px 20px var(--shadow);
            z-index: 900;
            border-radius: var(--radius) var(--radius) 0 0;
            border-top: 1px solid var(--border);
            transition: var(--transition);
        }

        .nav-item {
            text-align: center;
            color: var(--text-light);
            font-size: 0.8rem;
            transition: var(--transition);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            flex: 1;
        }

        .nav-item i {
            font-size: 1.4rem;
            transition: var(--transition);
        }

        .nav-item.active {
            color: var(--primary);
            transform: translateY(-3px);
        }

        .nav-item:hover {
            color: var(--primary);
        }

        /* Modals */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            backdrop-filter: blur(8px);
            z-index: 2000;
            visibility: hidden;
            opacity: 0;
            transition: var(--transition);
            display: flex;
            align-items: flex-end;
            justify-content: center;
        }

        .modal-overlay.active {
            visibility: visible;
            opacity: 1;
        }

        .modal-sheet {
            background: var(--card);
            width: 100%;
            max-width: 600px;
            border-radius: var(--radius) var(--radius) 0 0;
            padding: 30px;
            transform: translateY(100%);
            transition: 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.2);
        }

        .modal-overlay.active .modal-sheet {
            transform: translateY(0);
        }

        .sheet-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border);
        }

        .sheet-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
        }

        .close-btn {
            background: var(--card);
            border: 1px solid var(--border);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            color: var(--text-light);
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }

        .close-btn:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        /* Buttons */
        .btn-main {
            width: 100%;
            padding: 16px;
            border: none;
            border-radius: var(--radius-sm);
            background: var(--gradient);
            color: white;
            font-weight: 600;
            font-size: 1rem;
            margin-top: 20px;
            box-shadow: 0 8px 20px rgba(108, 99, 255, 0.3);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-main:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(108, 99, 255, 0.4);
        }

        .btn-main:active {
            transform: translateY(-1px);
        }

        .btn-outline {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--primary);
            background: transparent;
            border-radius: var(--radius-sm);
            font-weight: 600;
            color: var(--primary);
            margin-top: 15px;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-outline:hover {
            background: rgba(108, 99, 255, 0.1);
        }

        /* Payment Section */
        .bank-card {
            background: var(--card);
            border: 1px dashed var(--primary);
            padding: 20px;
            border-radius: var(--radius-sm);
            margin: 20px 0;
            font-size: 0.95rem;
            box-shadow: 0 5px 15px rgba(108, 99, 255, 0.1);
        }

        .qr-area {
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: var(--bg);
            border-radius: var(--radius-sm);
        }

        .qr-img {
            max-width: 220px;
            border-radius: var(--radius-sm);
            display: none;
            border: 1px solid var(--border);
            padding: 10px;
            background: white;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-size: 0.85rem;
            color: var(--text-light);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .input-group input {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            outline: none;
            font-size: 0.95rem;
            background: var(--bg);
            color: var(--text);
            transition: var(--transition);
        }

        .input-group input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(108, 99, 255, 0.1);
        }

        /* Order Status Cards */
        .status-card {
            background: var(--card);
            padding: 18px;
            border-radius: var(--radius-sm);
            margin-bottom: 15px;
            border-left: 5px solid #ccc;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border: 1px solid var(--border);
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-badge {
            padding: 5px 12px;
            border-radius: 30px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(255, 159, 67, 0.1);
            color: var(--orange);
        }

        .status-approved {
            background: rgba(0, 184, 148, 0.1);
            color: var(--green);
        }

        .status-rejected {
            background: rgba(255, 118, 117, 0.1);
            color: var(--red);
        }

        /* Animations */
        @keyframes slideDown {
            from { transform: translateY(-100%); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Loading Spinner */
        .loading {
            grid-column: 1 / -1;
            text-align: center;
            margin: 50px 0;
            color: var(--text-light);
            animation: fadeIn 0.5s;
        }

        .loading i {
            font-size: 2rem;
            margin-bottom: 15px;
            color: var(--primary);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-wrap: wrap;
            }
            
            .search-box {
                order: 3;
                margin-top: 15px;
                max-width: 100%;
            }
            
            .grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 20px;
            }
            
            .section-title {
                font-size: 1.5rem;
            }
            
            .modal-sheet {
                padding: 25px 20px;
            }
        }

        @media (max-width: 480px) {
            .grid {
                grid-template-columns: 1fr;
            }
            
            .header-actions {
                gap: 15px;
            }
            
            .brand {
                font-size: 1.4rem;
            }
            
            .section-title::after {
                width: 50px;
            }
            
            .p-img {
                height: 160px;
            }
        }

        /* Dark mode specific adjustments */
        .dark-mode .search-box input {
            background-color: var(--card);
        }
        
        .dark-mode .bank-card {
            background-color: rgba(255, 255, 255, 0.05);
        }
        
        .dark-mode .qr-img {
            background-color: white;
        }
    </style>
</head>
<body class="light-mode">
    <!-- Notice Banner -->
    <div id="notice-area"></div>

    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="brand">
                <!-- Logo Placeholder - आप इसे अपने logo.png से replace कर सकते हैं -->
                <div id="logo-placeholder">AI</div>
                <!-- यदि आप logo.png file add करना चाहते हैं, तो ऊपर की line को comment करें और नीचे की line uncomment करें -->
                <!-- <img src="logo.png" alt="AI Pro Like Logo" class="site-logo"> -->
                <span>AI Pro Like</span>
            </div>
            
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" id="search" placeholder="Search products...">
            </div>
            
            <div class="header-actions">
                <!-- Theme Toggle -->
                <div class="theme-toggle" id="themeToggle">
                    <i class="fas fa-sun sun"></i>
                    <i class="fas fa-moon moon"></i>
                </div>
                
                <!-- User Profile -->
                <div class="user-profile" onclick="openProfile()">
                    <i class="fas fa-user"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container">
        <h2 class="section-title">Digital Products</h2>
        <div id="grid" class="grid">
            <!-- Products will be loaded here -->
            <div class="loading">
                <i class="fas fa-circle-notch fa-spin"></i>
                <p>Loading products...</p>
            </div>
        </div>
    </div>

    <!-- Product Detail Modal -->
    <div id="modal-prod" class="modal-overlay">
        <div class="modal-sheet">
            <div class="sheet-header">
                <div class="sheet-title">Product Details</div>
                <button class="close-btn" onclick="closeModal('modal-prod')">&times;</button>
            </div>
            <div id="d-img" style="width:100%; height:220px; background:#eee; border-radius:var(--radius); background-size:cover; margin-bottom:20px;"></div>
            <h2 id="d-name" style="margin-bottom:5px;">Product Name</h2>
            <h3 id="d-price" style="color:var(--primary); margin-bottom:15px;">$0.00</h3>
            <p id="d-desc" style="color:var(--text-light); font-size:0.95rem; line-height:1.7; margin: 20px 0;">Description...</p>
            <button class="btn-main" onclick="goToPay()">
                <i class="fas fa-shopping-cart"></i> Buy Now
            </button>
        </div>
    </div>

    <!-- Payment Modal -->
    <div id="modal-pay" class="modal-overlay">
        <div class="modal-sheet">
            <div class="sheet-header">
                <div class="sheet-title">Checkout</div>
                <button class="close-btn" onclick="closeModal('modal-pay')">&times;</button>
            </div>
            
            <div class="bank-card">
                <h4 style="margin-bottom:10px; color:var(--text);">Payment Details</h4>
                <div id="bank-det">Loading Bank Details...</div>
                <div id="pay-inst" style="margin-top:15px; padding-top:15px; border-top:1px dashed var(--border); color:var(--orange); font-size:0.85rem;"></div>
            </div>

            <button class="btn-outline" onclick="loadQR()">
                <i class="fas fa-qrcode"></i> Show Payment QR Code
            </button>
            
            <div class="qr-area">
                <div id="qr-loader" style="display:none; padding:20px;">
                    <i class="fas fa-spinner fa-spin" style="font-size:1.5rem; color:var(--primary);"></i>
                    <p style="margin-top:10px; color:var(--text-light);">Loading QR Code...</p>
                </div>
                <img id="qr-img" class="qr-img" alt="Payment QR Code">
            </div>

            <div class="input-group">
                <label>Your Full Name</label>
                <input type="text" id="ord-name" placeholder="Enter your name">
            </div>
            <div class="input-group">
                <label>Email Address (for delivery)</label>
                <input type="email" id="ord-email" placeholder="Enter your email">
            </div>
            <div class="input-group">
                <label>Transaction ID / Reference Number</label>
                <input type="text" id="ord-ref" placeholder="Paste transaction ID here">
            </div>

            <button class="btn-main" onclick="submitOrder()">
                <i class="fas fa-check-circle"></i> Confirm Payment
            </button>
        </div>
    </div>

    <!-- Profile & Orders Modal -->
    <div id="modal-prof" class="modal-overlay">
        <div class="modal-sheet">
            <div class="sheet-header">
                <div class="sheet-title">My Orders</div>
                <button class="close-btn" onclick="closeModal('modal-prof')">&times;</button>
            </div>
            
            <div class="input-group" style="display:flex; gap:10px; margin-bottom:25px;">
                <input type="email" id="track-email" placeholder="Enter your email to track orders">
                <button onclick="track()" style="padding:0 20px; border:none; background:var(--primary); color:white; border-radius:var(--radius-sm); cursor:pointer; transition:var(--transition);">
                    <i class="fas fa-search"></i>
                </button>
            </div>
            
            <div id="history" style="margin-top:10px; max-height:400px; overflow-y:auto; padding-right:5px;">
                <!-- Orders will be displayed here -->
                <div style="text-align:center; color:var(--text-light); padding:40px 20px;">
                    <i class="fas fa-box-open" style="font-size:3rem; margin-bottom:15px; opacity:0.5;"></i>
                    <p>Enter your email to view order history</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-item active" onclick="window.scrollTo({top: 0, behavior: 'smooth'})">
            <i class="fas fa-home"></i>
            <span>Home</span>
        </div>
        <div class="nav-item" onclick="openProfile()">
            <i class="fas fa-box-open"></i>
            <span>Orders</span>
        </div>
        <div class="nav-item" onclick="window.open('mailto:adnan55amir45@gmail.com')">
            <i class="fas fa-headset"></i>
            <span>Support</span>
        </div>
        <div class="nav-item" onclick="toggleTheme()">
            <i class="fas fa-palette"></i>
            <span>Theme</span>
        </div>
    </div>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAGUjJ47wOlND5-6Au97AOdb5ALzwUbx_Q",
            authDomain: "mobile-repairing-1c087.firebaseapp.com",
            databaseURL: "https://mobile-repairing-1c087-default-rtdb.firebaseio.com",
            projectId: "mobile-repairing-1c087",
            storageBucket: "mobile-repairing-1c087.firebasestorage.app",
            messagingSenderId: "313283568116",
            appId: "1:313283568116:web:a5e15db94303dbf9ee59a1"
        };
        
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        
        // Global Variables
        let products = [];
        let curProd = null;
        let settings = {};
        let isDarkMode = false;

        // Initialize on page load
        window.onload = () => {
            // Track visit
            db.ref('analytics/visits').transaction(v => (v||0)+1);
            
            // Load data
            loadData();
            
            // Restore user email if exists
            const lastEmail = localStorage.getItem('userEmail');
            if(lastEmail) {
                document.getElementById('track-email').value = lastEmail;
                track();
            }
            
            // Setup theme from localStorage
            const savedTheme = localStorage.getItem('theme');
            if(savedTheme === 'dark') {
                toggleTheme();
            }
            
            // Setup search functionality
            document.getElementById('search').addEventListener('input', filterProds);
            
            // Setup enter key for tracking
            document.getElementById('track-email').addEventListener('keyup', (e) => {
                if(e.key === 'Enter') track();
            });
        };

        // Load products and settings from Firebase
        function loadData() {
            // Load products
            db.ref('products').on('value', snapshot => {
                products = [];
                const grid = document.getElementById('grid');
                grid.innerHTML = '';
                
                snapshot.forEach(child => {
                    const product = child.val();
                    product.id = child.key;
                    products.push(product);
                    
                    // Create product card
                    grid.innerHTML += `
                    <div class="product-card" onclick="openProd('${product.id}')">
                        ${product.badge ? `<div class="p-badge">${product.badge}</div>` : ''}
                        <div class="p-img" style="background-image:url('${product.image || 'https://images.unsplash.com/photo-1611224923853-80b023f02d71?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'}')"></div>
                        <div class="p-details">
                            <div class="p-title">${product.name}</div>
                            <div class="p-desc">${product.shortDesc || product.desc?.substring(0, 80) + '...' || 'Premium digital product'}</div>
                            <div class="p-footer">
                                <div class="p-price">$${product.price}</div>
                                <div class="btn-buy-mini">
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                            </div>
                        </div>
                    </div>`;
                });
                
                // Add animation to cards
                setTimeout(() => {
                    const cards = document.querySelectorAll('.product-card');
                    cards.forEach((card, index) => {
                        card.style.animation = `fadeIn 0.5s ease ${index * 0.1}s forwards`;
                        card.style.opacity = '0';
                    });
                }, 100);
            });

            // Load settings
            db.ref('settings').on('value', snapshot => {
                settings = snapshot.val() || {};
                
                // Update notice banner
                const noticeArea = document.getElementById('notice-area');
                if(settings.noticeOn && settings.notice) {
                    noticeArea.innerText = settings.notice;
                    noticeArea.style.display = 'block';
                } else {
                    noticeArea.style.display = 'none';
                }
                
                // Update bank details
                document.getElementById('bank-det').innerHTML = `
                    <div><b>Bank:</b> ${settings.bank || 'N/A'}</div>
                    <div><b>Account Title:</b> ${settings.title || 'N/A'}</div>
                    <div><b>Account Number:</b> ${settings.num || 'N/A'}</div>
                `;
                
                // Update payment instructions
                document.getElementById('pay-inst').innerText = settings.inst || '';
            });
        }

        // Filter products based on search
        function filterProds() {
            const query = document.getElementById('search').value.toLowerCase().trim();
            const grid = document.getElementById('grid');
            
            if(!query) {
                // Reset to all products
                grid.innerHTML = '';
                products.forEach(product => {
                    grid.innerHTML += `
                    <div class="product-card" onclick="openProd('${product.id}')">
                        ${product.badge ? `<div class="p-badge">${product.badge}</div>` : ''}
                        <div class="p-img" style="background-image:url('${product.image || 'https://images.unsplash.com/photo-1611224923853-80b023f02d71?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'}')"></div>
                        <div class="p-details">
                            <div class="p-title">${product.name}</div>
                            <div class="p-desc">${product.shortDesc || product.desc?.substring(0, 80) + '...' || 'Premium digital product'}</div>
                            <div class="p-footer">
                                <div class="p-price">$${product.price}</div>
                                <div class="btn-buy-mini">
                                    <i class="fas fa-shopping-cart"></i>
                                </div>
                            </div>
                        </div>
                    </div>`;
                });
                return;
            }
            
            // Filter products
            const filtered = products.filter(p => 
                p.name.toLowerCase().includes(query) || 
                (p.desc && p.desc.toLowerCase().includes(query))
            );
            
            grid.innerHTML = '';
            
            if(filtered.length === 0) {
                grid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--text-light);">
                    <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 15px; opacity: 0.5;"></i>
                    <h3>No products found</h3>
                    <p>Try a different search term</p>
                </div>`;
                return;
            }
            
            filtered.forEach(product => {
                grid.innerHTML += `
                <div class="product-card" onclick="openProd('${product.id}')">
                    ${product.badge ? `<div class="p-badge">${product.badge}</div>` : ''}
                    <div class="p-img" style="background-image:url('${product.image || 'https://images.unsplash.com/photo-1611224923853-80b023f02d71?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'}')"></div>
                    <div class="p-details">
                        <div class="p-title">${product.name}</div>
                        <div class="p-desc">${product.shortDesc || product.desc?.substring(0, 80) + '...' || 'Premium digital product'}</div>
                        <div class="p-footer">
                            <div class="p-price">$${product.price}</div>
                            <div class="btn-buy-mini">
                                <i class="fas fa-shopping-cart"></i>
                            </div>
                        </div>
                    </div>
                </div>`;
            });
        }

        // Open product detail modal
        function openProd(id) {
            curProd = products.find(p => p.id === id);
            if(!curProd) return;
            
            document.getElementById('d-img').style.backgroundImage = `url('${curProd.image || 'https://images.unsplash.com/photo-1611224923853-80b023f02d71?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=500&q=80'}')`;
            document.getElementById('d-name').innerText = curProd.name;
            document.getElementById('d-price').innerText = '$' + curProd.price;
            document.getElementById('d-desc').innerText = curProd.desc || 'No description available.';
            
            openModal('modal-prod');
        }

        // Go to payment screen
        function goToPay() {
            if(!curProd) return;
            
            closeModal('modal-prod');
            setTimeout(() => {
                openModal('modal-pay');
                // Reset QR code display
                document.getElementById('qr-img').style.display = 'none';
                document.getElementById('qr-loader').style.display = 'none';
            }, 300);
        }

        // Load QR code
        function loadQR() {
            if(!settings.img) {
                alert('No QR Code available at the moment. Please use bank transfer details.');
                return;
            }
            
            const img = document.getElementById('qr-img');
            const loader = document.getElementById('qr-loader');
            
            loader.style.display = 'block';
            img.style.display = 'none';
            img.src = settings.img;
            
            img.onload = () => {
                loader.style.display = 'none';
                img.style.display = 'block';
            };
            
            img.onerror = () => {
                loader.style.display = 'none';
                alert('Failed to load QR code. Please try again or use bank transfer.');
            };
        }

        // Submit order
        function submitOrder() {
            const name = document.getElementById('ord-name').value.trim();
            const email = document.getElementById('ord-email').value.trim();
            const ref = document.getElementById('ord-ref').value.trim();
            
            if(!name || !email || !ref) {
                alert('Please fill in all required fields.');
                return;
            }
            
            if(!curProd) {
                alert('Product information missing. Please try again.');
                return;
            }
            
            // Save order to Firebase
            db.ref('orders').push({
                userName: name,
                userEmail: email,
                ref: ref,
                productName: curProd.name,
                price: curProd.price,
                productId: curProd.id,
                status: 'Pending',
                ts: Date.now()
            });
            
            // Save email to localStorage
            localStorage.setItem('userEmail', email);
            
            // Show success message
            alert('Order submitted successfully! We will notify you via email once approved.');
            
            // Clear form
            document.getElementById('ord-name').value = '';
            document.getElementById('ord-email').value = '';
            document.getElementById('ord-ref').value = '';
            
            closeModal('modal-pay');
        }

        // Track orders by email
        function track() {
            const email = document.getElementById('track-email').value.trim();
            if(!email) {
                alert('Please enter your email address.');
                return;
            }
            
            localStorage.setItem('userEmail', email);
            
            db.ref('orders').orderByChild('userEmail').equalTo(email).once('value', snapshot => {
                const historyDiv = document.getElementById('history');
                historyDiv.innerHTML = '';
                
                if(!snapshot.exists()) {
                    historyDiv.innerHTML = `
                    <div style="text-align:center; color:var(--text-light); padding:40px 20px;">
                        <i class="fas fa-inbox" style="font-size:3rem; margin-bottom:15px; opacity:0.5;"></i>
                        <p>No orders found for this email.</p>
                    </div>`;
                    return;
                }
                
                let orders = [];
                snapshot.forEach(child => {
                    orders.push({ id: child.key, ...child.val() });
                });
                
                // Sort by timestamp (newest first)
                orders.sort((a, b) => b.ts - a.ts);
                
                orders.forEach(order => {
                    let statusClass = 'status-pending';
                    let statusText = 'Processing';
                    let downloadBtn = '';
                    
                    if(order.status === 'Approved') {
                        statusClass = 'status-approved';
                        statusText = 'Approved';
                        downloadBtn = `
                        <button style="background:var(--primary); color:white; border:none; padding:10px; border-radius:var(--radius-sm); margin-top:10px; width:100%; cursor:pointer;" onclick="dl('${order.productId}')">
                            <i class="fas fa-download"></i> Download File
                        </button>`;
                    } else if(order.status === 'Rejected') {
                        statusClass = 'status-rejected';
                        statusText = 'Rejected';
                    }
                    
                    historyDiv.innerHTML += `
                    <div class="status-card">
                        <div class="status-header">
                            <div>
                                <b style="color:var(--text);">${order.productName}</b>
                                <div style="font-size:0.85rem; color:var(--text-light); margin-top:5px;">Ref: ${order.ref}</div>
                            </div>
                            <div class="status-badge ${statusClass}">${statusText}</div>
                        </div>
                        <div style="font-size:0.85rem; color:var(--text-light);">
                            <i class="far fa-calendar"></i> ${new Date(order.ts).toLocaleDateString()}
                            <span style="margin-left:15px;"><i class="fas fa-dollar-sign"></i> ${order.price}</span>
                        </div>
                        ${downloadBtn}
                    </div>`;
                });
            });
        }

        // Download product file
        function dl(productId) {
            db.ref('products/' + productId + '/link').once('value', snapshot => {
                const link = snapshot.val();
                if(link) {
                    window.open(link, '_blank');
                } else {
                    alert('Download link not available. Please contact support.');
                }
            });
        }

        // Modal functions
        function openModal(id) {
            document.getElementById(id).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Open profile modal
        function openProfile() {
            openModal('modal-prof');
            track();
        }

        // Toggle dark/light theme
        function toggleTheme() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            document.body.classList.toggle('light-mode', !isDarkMode);
            
            // Update toggle button position
            const themeToggle = document.getElementById('themeToggle');
            if(isDarkMode) {
                themeToggle.style.justifyContent = 'flex-end';
                localStorage.setItem('theme', 'dark');
            } else {
                themeToggle.style.justifyContent = 'flex-start';
                localStorage.setItem('theme', 'light');
            }
        }

        // Initialize theme toggle position
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        
        // Set initial toggle position based on saved theme
        const savedTheme = localStorage.getItem('theme');
        const themeToggle = document.getElementById('themeToggle');
        if(savedTheme === 'dark') {
            themeToggle.style.justifyContent = 'flex-end';
        } else {
            themeToggle.style.justifyContent = 'flex-start';
        }
    </script>
</body>
</html>